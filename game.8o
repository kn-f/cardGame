# Test card

# Sprites
: sp_mazzo 0x7E 0x42 0x52 0x4A 0x52 0x4A 0x42 0x7E 0xFF 0x00 0x00 0x00 0x00 0x00 0x00
: sp_spade 0x18 0x24 0x24 0x24 0x24 0x7E 0x18 0x18 0xFF 0x00 0x00 0x00 0x00 0x00 0x00
: sp_bastoni 0x0C 0x12 0x12 0x24 0x28 0x50 0x60 0xC0 0xFF 0x00 0x00 0x00 0x00 0x00 0x00
: sp_coppe 0x00 0x7E 0x42 0x42 0x24 0x24 0x18 0x3C 0xFF 0x00 0x00 0x00 0x00 0x00 0x00
: sp_ori 0x00 0x3C 0x42 0x42 0x42 0x42 0x3C 0x00 0xFF 0x00 0x00 0x00 0x00 0x00 0x00
: sp_nothing 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
: sp_game_over 0x64 0x8A 0xAE 0x6A 0xAE 0xEC 0xA8 0xAE 0x4A 0xAA 0xAA 0x44 0xEC 0xCA 0x8C 0xEA

# Memory
: mazzo_mescolato 0x00 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x09
									0x10 0x11 0x12 0x13 0x14 0x15 0x16 0x17 0x18 0x19
									0x20 0x21 0x22 0x23 0x24 0x25 0x26 0x27 0x28 0x29
									0x30 0x31 0x32 0x33 0x34 0x35 0x36 0x37 0x38 0x39

:const sprite_size 8
:const mazzo_x 7
:const mazzo_y 6
:const nemici_y 0
:const giocatore_y 4
:const mask_seme 0xF0
:const mask_numero 0x0F

:alias key_pressed va
:alias x vb
:alias y vc
:alias nemici_1 v3
:alias nemici_2 v4
:alias nemici_3 v5
:alias giocatore_1 v6
:alias giocatore_2 v7
:alias giocatore_3 v8
:alias carta_pescata v0
:alias temp va
:alias turno vd
:alias seme ve
:alias numero ve



:macro draw_at X Y IMG {
	:calc RX { X * sprite_size / 2 }
	:calc RY { Y * sprite_size / 2 }
	i := IMG
	x := RX
	y := RY
	sprite x y sprite_size
}

: main
	turno := 39
	
	clear

	draw_screen
	draw_card

	loop
		key_pressed := key
		draw_card
		turno += 1
		if turno >= 40 then end_game
		draw_card
	again

: draw_screen
	clear
	draw_enemies
	draw_mazzo
	draw_giocatore
return
	
	
: draw_mazzo
	draw_at mazzo_x mazzo_y sp_mazzo
return

: draw_enemies
	draw_at 1 nemici_y sp_bastoni
	draw_at 3 nemici_y sp_bastoni
	draw_at 5 nemici_y sp_bastoni

return

: draw_giocatore
	draw_at 1 giocatore_y sp_ori
	draw_at 3 giocatore_y sp_spade
return

: draw_card
	i := mazzo_mescolato
	i += turno
	load carta_pescata
	temp := mask_seme
	seme := carta_pescata
	seme &= temp
	#seme := temp
	if seme == 0x00 begin draw_at 9 mazzo_y sp_spade
	else if seme == 0x10 begin draw_at 9 mazzo_y sp_bastoni
	else if seme == 0x20 begin draw_at 9 mazzo_y sp_coppe
	else if seme == 0x30 begin draw_at 9 mazzo_y sp_ori end end end end
	temp := mask_numero
	numero := carta_pescata
	numero &= temp
	numero += 1
	i := hex numero
	x := 44
	y := 20
	sprite x y 5
return

: print_stats
return

: end_game
	clear
	v0 := 12
	v1 := 12
	v2 := 4
	i := sp_game_over
	sprite v0 v1 4
	i += v2
	v0 += 8
	sprite v0 v1 4
	i += v2
	v0 := 12
	v1 += 8
	sprite v0 v1 4
	i += v2
	v0 += 8
	sprite v0 v1 4
